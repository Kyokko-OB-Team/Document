## 中継サーバー　総括仕様書

### 変更履歴

| ver  | 変更日     | 変更者       | 変更内容 |
| ---- | ---------- | ------------ | -------- |
| 1.0  | 2021/07/03 | M.Hahshimoto | 初版     |
|      |            |              |          |
|      |            |              |          |

### 目次

- 概要
- システム構成
- 機能一覧
- 



### 機能概要

- クライアントとの接続状態管理を行う。
- クラウドから受信した窓開閉指示をクライアントへ送信する。
- 



### システム構成





### 機能一覧

- #### 接続監視機能

  - クライアントから受信した



### 回線管理機能

- クライアントから「通信開始コマンド(コマンドID:0x01)」を受信した時、以下の処理を行う。

  - FireStoreの「client_info」から受信した機器Noを検索し、検索結果によって以下処理を行う。

    - 該当機器Noが見つからない場合、クライアント種別を「0x00(未設定)」で応答(ACK)を返す。

    - 受信機器Noが「0x00」の場合、クライアント種別を「0x00(未設定)」で応答(ACK)を返す。

    - 受信したクライアントと同一機器Noがすでに登録しており、通信開始になっている場合、

      クライアント種別を「0x00(未設定)」で応答を返す。

    - 上記以外の場合、登録されているクライアント種別を応答(ACK)する。

  - FireStoreの「client_info」にクライアント情報を書き込む。

  - FireStoreにアクセスできない場合や「client_info」が読み込めない場合、異常応答(NAK)を返す。

- 

























